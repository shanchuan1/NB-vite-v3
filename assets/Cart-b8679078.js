import{_ as N,n as S,u as V,y as A,a as T,o as q,T as m,z as G,A as z,t as D,e as r,b as _,c as v,f as d,d as a,w as u,B as x,x as w,C as E,D as F,F as P,m as R,q as b,h as B}from"./index-50a67697.js";import{s as U}from"./SimpleHeader-24c54a75.js";const H={components:{navBar:S,sHeader:U},setup(){const s=V(),i=A(),o=T({checked:!1,list:[],all:!1,result:[],checkAll:!0});q(()=>{n()});const n=async()=>{m.loading({message:"加载中...",forbidClick:!0});const{data:t}=await G({pageNumber:1});o.list=t,o.result=t.map(c=>c.cartItemId),m.clear()},y=z(()=>o.list.filter(e=>o.result.includes(e.cartItemId)).reduce((e,l)=>e+l.goodsCount*l.sellingPrice,0)),I=()=>{s.go(-1)},h=()=>{s.push({path:"/home"})},g=async(t,c)=>{if(o.list.filter(l=>l.cartItemId==c.name)[0].goodsCount==t)return;m.loading({message:"修改中...",forbidClick:!0});const e={cartItemId:c.name,goodsCount:t};await E(e),o.list.forEach(l=>{l.cartItemId==c.name&&(l.goodsCount=t)}),m.clear()},C=async()=>{if(o.result.length==0){m.fail("请选择商品进行结算");return}const t=JSON.stringify(o.result);s.push({path:"/create-order",query:{cartItemIds:t}})},p=async t=>{await F(t),i.dispatch("updateCart"),n()},k=t=>{o.checkAll=t.length==o.list.length},f=()=>{o.checkAll?o.result=[]:o.result=o.list.map(t=>t.cartItemId)};return{...D(o),total:y,goBack:I,goTo:h,onChange:g,onSubmit:C,deleteGood:p,groupChange:k,allCheck:f}}},J={class:"cart-box"},L={class:"cart-body"},M={class:"good-item"},O={class:"good-img"},j=["src"],K={class:"good-desc"},Q={class:"good-title"},W={class:"good-btn"},X={class:"price"},Y={key:1,class:"empty"},Z=a("img",{class:"empty-cart",src:"https://s.yezgea02.com/1604028375097/empty-car.png",alt:"空购物车"},null,-1),$=a("div",{class:"title"},"购物车空空如也",-1);function ee(s,i,o,n,y,I){const h=r("s-header"),g=r("van-checkbox"),C=r("van-stepper"),p=r("van-button"),k=r("van-swipe-cell"),f=r("van-checkbox-group"),t=r("van-submit-bar"),c=r("nav-bar");return _(),v("div",J,[d(h,{name:"购物车",noback:!0}),a("div",L,[d(f,{onChange:n.groupChange,modelValue:s.result,"onUpdate:modelValue":i[0]||(i[0]=e=>s.result=e),ref:"checkboxGroup"},{default:u(()=>[(_(!0),v(P,null,R(s.list,(e,l)=>(_(),x(k,{"right-width":50,key:l},{right:u(()=>[d(p,{square:"",icon:"delete",type:"danger",class:"delete-button",onClick:te=>n.deleteGood(e.cartItemId)},null,8,["onClick"])]),default:u(()=>[a("div",M,[d(g,{name:e.cartItemId},null,8,["name"]),a("div",O,[a("img",{src:s.$filters.prefix(e.goodsCoverImg),alt:""},null,8,j)]),a("div",K,[a("div",Q,[a("span",null,b(e.goodsName),1),a("span",null,"x"+b(e.goodsCount),1)]),a("div",W,[a("div",X,"¥"+b(e.sellingPrice),1),d(C,{integer:"",min:1,max:5,"model-value":e.goodsCount,name:e.cartItemId,"async-change":"",onChange:n.onChange},null,8,["model-value","name","onChange"])])])])]),_:2},1024))),128))]),_:1},8,["onChange","modelValue"])]),s.list.length>0?(_(),x(t,{key:0,class:"submit-all van-hairline--top",price:n.total*100,"button-text":"结算",onSubmit:n.onSubmit},{default:u(()=>[d(g,{onClick:n.allCheck,checked:s.checkAll,"onUpdate:checked":i[1]||(i[1]=e=>s.checkAll=e)},{default:u(()=>[B("全选")]),_:1},8,["onClick","checked"])]),_:1},8,["price","onSubmit"])):w("",!0),s.list.length?w("",!0):(_(),v("div",Y,[Z,$,d(p,{round:"",color:"#1baeae",type:"primary",onClick:n.goTo,block:""},{default:u(()=>[B("前往选购")]),_:1},8,["onClick"])])),d(c)])}const ae=N(H,[["render",ee]]);export{ae as default};
